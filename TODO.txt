host:
firewall-cmd --permanent --new-zone=adm
firewall-cmd --permanent --new-zone=prd
firewall-cmd --permanent --new-zone=dev
firewall-cmd --permanent --add-interface=virbr0 --zone=adm
firewall-cmd --permanent --add-interface=virbr1 --zone=prd
firewall-cmd --permanent --add-interface=virbr2 --zone=dev
#firewall-cmd --permanent --add-interface=eth0 --zone=public
#firewall-cmd --permanent --add-interface=xlcbr0 --zone=internal
firewall-cmd --permanent --zone=public --add-masquerade
firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 0 -m physdev --physdev-is-bridged -j ACCEPT
firewall-cmd --permanent --direct --add-rule ipv6 filter FORWARD 0 -m physdev --physdev-is-bridged -j ACCEPT
firewall-cmd --reload

cat /etc/sysctl.d/10-ip-forward.conf
net.ipv4.ip_forward = 1
net.ipv4.conf.all.send_redirects=0

firefox import forman_dev and foreman_prd ca certificate as trusted
about:config
network.websocket.allowInsecureFromHTTPS true

dns resolution:
cat >/etc/NetworkManager/conf.d/localdns.conf <<EOL
[main]
dns=dnsmasq
EOL

cat >/etc/resolv.conf <<EOL
# Generated by NetworkManager
search guest.oic adm.lan prd.lan dev.lan
nameserver 127.0.0.1
EOL

cat >/etc/NetworkManager/dnsmasq.d/libvirt.conf <<EOL
server=/adm.lan/192.168.0.1 # resolve throught local kvm server
server=/prd.lan/172.16.10.10 # resolve throught foreman.prd.lan server
server=/dev.lan/172.16.20.20 # resolve throught foreman.dev.lan server
EOL

foreman-prd:
virsh net-destroy default
virsh net-undefine default

cat > /root/prd-lan.xml <<EOL
<network connections='2' ipv6='yes'>
  <name>prd-lan</name>
  <forward mode='nat'>
    <nat>
      <port start='1024' end='65535'/>
    </nat>
  </forward>
  <bridge name='virbr0' stp='on' delay='0'/>
  <mac address='52:54:00:a9:71:73'/>
  <domain name='prd.lan'/>
  <ip address='10.10.0.1' netmask='255.255.255.0'>
    <dhcp>
      <range start='10.10.0.2' end='10.10.0.254'/>
    </dhcp>
  </ip>
</network>
EOL

virsh net-define /root/prd-lan.xml
virsh net-autostart prd-lan
virsh net-start prd-lan

cat > /etc/sysctl.d/10-ip-forward.conf <<EOL
net.ipv4.ip_forward = 1
net.ipv4.conf.all.send_redirects=0
EOL

foreman-dev:
virsh net-destroy default
virsh net-undefine default

cat > /root/dev-lan.xml <<EOL
<network connections='2' ipv6='yes'>
  <name>dev-lan</name>
  <forward mode='nat'>
    <nat>
      <port start='1024' end='65535'/>
    </nat>
  </forward>
  <bridge name='virbr0' stp='on' delay='0'/>
  <mac address='52:54:00:96:d2:4d'/>
  <domain name='dev.lan'/>
  <ip address='10.20.0.1' netmask='255.255.255.0'>
    <dhcp>
      <range start='10.20.0.2' end='10.20.0.254'/>
    </dhcp>
  </ip>
  <ip family='ipv6' address='2001:db8::1' prefix='64'>
  </ip>
</network>
EOL

virsh net-define /root/dev-lan.xml
virsh net-autostart dev-lan
virsh net-start dev-lan

cat > /etc/sysctl.d/10-ip-forward.conf <<EOL
net.ipv4.ip_forward = 1
net.ipv4.conf.all.send_redirects=0
EOL
